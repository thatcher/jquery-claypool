var Claypool={Logging:{},extend:function(c,b,a){b.apply(c,a||[])}};(function(b,a){a.Logging.NullLogger=function(){var c=function(){return this};b.extend(this,{debug:c,info:c,warn:c,error:c,exception:c});return this};b.extend(a.Logging.NullLogger.prototype,{getLogger:function(){return new a.Logging.NullLogger()}})})(jQuery,Claypool);(function(b,a){a.Configuration={ioc:[],aop:[],logging:[],mvc:{"hijax:a":[],"hijax:form":[],"hijax:button":[],"hijax:event":[]},env:{dev:{},prod:{},test:{}}}})(jQuery,Claypool);(function(b,a){a.CachingStrategy$Interface={cache:null,size:null,clear:function(){throw"MethodNotImplementedError"},add:function(d,c){throw"MethodNotImplementedError"},remove:function(c){throw"MethodNotImplementedError"},find:function(c){throw"MethodNotImplementedError"}}})(jQuery,Claypool);(function(b,a){a.SimpleCachingStrategy=function(c){b.extend(true,this,c);this.logger=new a.Logging.NullLogger();this.clear();return this};b.extend(a.SimpleCachingStrategy.prototype,a.CachingStrategy$Interface,{clear:function(){this.logger.debug("Clearing Cache.");this.cache=null;this.cache={};this.size=0},add:function(d,c){this.logger.debug("Adding To Cache: %s",d);if(!this.cache[d]){this.cache[d]=c;this.size++;return d}return null},remove:function(c){this.logger.debug("Removing From Cache id: %s",c);if(this.find(c)){return(delete this.cache[c])?--this.size:-1}return null},find:function(c){this.logger.debug("Searching Cache for id: %s",c);return this.cache[c]||null}})})(jQuery,Claypool);(function(b,a){a.Context=function(c){a.extend(this,a.SimpleCachingStrategy);b.extend(true,this,c);this.logger=new a.Logging.NullLogger()};b.extend(a.Context.prototype,a.SimpleCachingStrategy.prototype,{get:function(c){throw"MethodNotImplementedError"},put:function(d,c){throw"MethodNotImplementedError"}})})(jQuery,Claypool);(function(b,a){a.ContextContributor=function(c){a.extend(this,a.Context);b.extend(true,this,c);this.logger=b.logger("Claypool.ContextContributor")};b.extend(a.ContextContributor.prototype,a.Context.prototype,{registerContext:function(c){throw"MethodNotImplementedError"}})})(jQuery,Claypool);(function(b,a){a.Router=function(c){a.extend(this,a.SimpleCachingStrategy);b.extend(true,this,c);this.logger=a.Logging.getLogger("Claypool.Router")};b.extend(a.Router.prototype,a.SimpleCachingStrategy.prototype,{compile:function(h,d){this.logger.debug("compiling patterns for match strategies");var g,l,k;var f,c;d=d.split("|");for(f=0;f<h.length;f++){for(c=0;c<d.length;c++){g=h[f][d[c]];k=[];if(g){this.logger.debug("Compiling \n\tpattern: %s for \n\ttarget.",g);g=g.replace(/\<\:(.+?)\:\>/g,function(){var j,m=arguments[0].indexOf("(");j=arguments[0].substring(2,m);k.push(j);return arguments[0].substring(m,arguments[0].length-2)});g=g.replace(/\|\:\w+\|/g,function(){var j;j=arguments[0].substring(2,arguments[0].length-1);k.push(j);return"([\\w\\-\\.]+)"});this.add(String(a.uuid()),{pattern:new RegExp(g),payload:h[f],params:k})}}}return this},first:function(d){this.logger.debug("Using strategy 'first'");var c,g,f={};for(g in this.cache){c=this.find(g);this.logger.debug("checking pattern %s for string %s",c.pattern,d);if(c&&c.pattern&&c.pattern.test&&c.pattern.test(d)){this.logger.debug("found match for \n\tpattern: %s \n\ttarget : %s ",c.pattern,c.payload.controller||c.payload.rewrite);if(c.params&&c.params.length>0){d.replace(c.pattern,function(){var h;for(h=1;h<arguments.length-2;h++){f[c.params[h-1]]=arguments[h]}})}return[b.extend({map:f},c)]}}this.logger.debug("found no match for \n\tpattern: %s",d);return[]},all:function(d){this.logger.debug("Using strategy 'all'");var f=[];var c,h,g={};for(h in this.cache){c=this.find(h);this.logger.debug("checking pattern: %s for string %s",c.pattern,d);if(c&&c.pattern&&c.pattern.test&&c.pattern.test(d)){this.logger.debug("found match for \n\tpattern: %s \n\ttarget : %s ",c.pattern,c.payload.controller);if(c.params&&c.params.length>0){d.replace(c.pattern,function(){var j;for(j=1;j<arguments.length-2;j++){g[c.params[j-1]]=arguments[j]}})}f.push(b.extend({map:g},c))}}if(f.length===0){this.logger.debug("found no match for \n\tpattern: %s",d)}return f}})})(jQuery,Claypool);(function(b,a){a.Factory$Interface={create:function(){throw"MethodNotImplementedError"}}})(jQuery,Claypool);(function(b,a){a.Configurable$Interface={configurationId:null,configuration:null,configurationUrl:null,configurationType:null,getConfig:function(){throw"MethodNotImplementedError"},loadConfig:function(){throw"MethodNotImplementedError"},setConfig:function(){throw"MethodNotImplementedError"},updateConfig:function(){throw"MethodNotImplementedError"}}})(jQuery,Claypool);(function(b,a){a.Scanner$Interface={scan:function(){throw"MethodNotImplementedError"}}})(jQuery,Claypool);(function(b,a){a.BaseFactory=function(c){a.extend(this,a.SimpleCachingStrategy);b.extend(true,this,{configurationUrl:"./app/configs/config.js",configurationType:"json"},c);this.logger=new a.Logging.NullLogger();return this};b.extend(a.BaseFactory.prototype,a.SimpleCachingStrategy.prototype,a.Factory$Interface,a.Configurable$Interface,a.Scanner$Interface,{getConfig:function(){if(!this.configuration){this.logger.debug("Configuration for <%s> has not been set explicitly or has been updated implicitly.",this.configurationId);this.logger.debug("$$.Configuration: \n %o",a.Configuration);if(a.Configuration[this.configurationId]){this.logger.debug("Found Claypool.Configuration");this.configuration=a.Configuration[this.configurationId]}else{if(!a.Configuration){this.loadConfig()}}}return this.configuration},loadConfig:function(c){c=c||{};this.configurationUrl=c.url||this.configurationUrl;this.logger.debug("Attempting to load configuration from: %s",this.configurationUrl);var d=this;jQuery.ajax({type:"Get",url:this.configurationUrl,async:false,data:{},dataType:"json",success:function(f){if(d.configurationUrl=="./app/configs/config.js"){a.Configuration=a.Configuration||{};b.extend(true,a.Configuration,f)}else{d.setConfig(d.configurationId,f?f:null)}if(c.callback){c.callback(a.Configuration)}}})},setConfig:function(d,c){this.logger.debug("Setting configuration");this.configuration=c;a.Configuration[d]=c},updateConfig:function(c){throw"MethodNotImplementedError"}})})(jQuery,Claypool);(function(g,b){var f=[],c=0,a={},d;g.extend(a,{$:function(l,k){var h,j;if(k===undefined){h=null;for(j=0;j<f.length;j++){h=f[j]().get(l);if(h){return h}}return null}else{f[0]().put(l,k)}},register:function(j,h){if(Math.abs(h)>(f.length-1)/2){if(h===0&&g.isFunction(j.getContext)){f[0]=j.getContext}else{if(h!==0){if(g.isFunction(j.getContext)){f.push(j.getContext)}if(g.isFunction(j.getCachedContext)){f.unshift(j.getCachedContext)}}}}},resolve:function(h){var m;var k;var l;var j;m=function(n){return this[n]};k=h.split(".");l=null;for(j=0;j<k.length;j++){l=m.call(l,k[j]);if(l===undefined){return l}}return l},config:function(){var h,j;if(arguments.length===0){return b.Configuration}else{if(arguments.length===1&&typeof(arguments[0])=="string"){return g.resolve("Claypool.Configuration."+arguments[0])}else{h=g.resolve("Claypool.Configuration."+arguments[0]);if(h){j=arguments[1];if(j instanceof Array){h=g.merge(h,j)}else{if(j instanceof Object){h=g.extend(true,h,j)}}}}}return this},env:function(){var j,h;if(arguments.length==2){d=g.extend(true,d||{},g.config("env."+arguments[0]),g.config("env."+arguments[1]));return d}else{if(arguments.length===0){h=g.config("env.automap");for(j in h){if(new RegExp(j).exec(window.location)){return g.env("defaults",h[j])}}}else{if(arguments.length===1&&!(typeof(arguments[0])=="string")){return g.config("env",arguments[0])}return d[arguments[0]]||null}}return null}});g.extend(b,a,{uuid:function(){return new Date().getTime()+"_"+(++c)+"_"+Math.round(Math.random()*100000000)}});g.extend(g,a)})(jQuery,Claypool);Claypool.Logging={NullLogger:null,getLogger:null};(function(b,a,c){b.extend(c,{loggerFactory:null,getLogger:function(d){if(!c.loggerFactory){c.loggerFactory=new c.Factory()}if(c.updated){c.loggerFactory.updateConfig();
c.updated=false}return c.loggerFactory.create(d)}})})(jQuery,Claypool,Claypool.Logging);(function(b,a,c){c.Level={DEBUG:0,INFO:1,WARN:2,ERROR:3,NONE:4}})(jQuery,Claypool,Claypool.Logging);(function(b,a,c){c.Logger$Interface={debug:function(){throw"MethodNotImplementedError"},info:function(){throw"MethodNotImplementedError"},warn:function(){throw"MethodNotImplementedError"},error:function(){throw"MethodNotImplementedError"},exception:function(){throw"MethodNotImplementedError"}}})(jQuery,Claypool,Claypool.Logging);(function(b,a,c){c.NullLogger=function(){var d=function(){return this};b.extend(this,{debug:d,info:d,warn:d,error:d,exception:d})}})(jQuery,Claypool,Claypool.Logging);(function(b,a,c){c.Logger=function(d){this.category="root";this.level=null;try{b.extend(true,this,d);this.level=c.Level[this.level?this.level:"NONE"];try{this.appender=new (b.resolve(this.appender||"Claypool.Logging.ConsoleAppender"))(d)}catch(f){try{this.appender=new c.ConsoleAppender(d)}catch(f){this.appender=new c.SysOutAppender(d)}}return this}catch(f){return new c.NullLogger()}};b.extend(c.Logger.prototype,c.Logger$Interface,{debug:function(){if(this.level<=c.Level.DEBUG){this.appender.append("DEBUG",this.category,arguments);return this}else{this.debug=function(){return this}}return this},info:function(){if(this.level<=c.Level.INFO){this.appender.append("INFO",this.category,arguments);return this}else{this.debug=function(){return this}}return this},warn:function(){if(this.level<=c.Level.WARN){this.appender.append("WARN",this.category,arguments);return this}else{this.debug=function(){return this}}return this},error:function(){if(this.level<=c.Level.ERROR){this.appender.append("ERROR",this.category,arguments);return this}else{this.debug=function(){return this}}return this},exception:function(d){if(this.level<c.Level.NONE){if(d){this.appender.append("EXCEPTION",this.category,d);return this}}else{this.debug=function(){return this}}return this}})})(jQuery,Claypool,Claypool.Logging);(function(b,a,c){c.Appender$Interface={formatter:null,append:function(g,f,d){throw new a.MethodNotImplementedError()}}})(jQuery,Claypool,Claypool.Logging);(function(b,a,c){c.SysOutAppender=function(f){var g=function(){var h=null;h.toString()};if(b.isFunction(print)&&(window.load!==undefined)&&b.isFunction(window.load)){try{g()}catch(d){if(d.rhinoException){b.extend(true,this,f);this.formatter=new c.DefaultFormatter(f);return this}}}throw new c.NoAppendersAvailableError()};b.extend(c.SysOutAppender.prototype,c.Appender$Interface,{append:function(h,f,d){switch(h){case"DEBUG":print(this.formatter.format(h,f,d));break;case"INFO":print(this.formatter.format(h,f,d));break;case"WARN":print(this.formatter.format(h,f,d));break;case"ERROR":print(this.formatter.format(h,f,d));break;case ("EXCEPTION"):var g=d&&d.rhinoException?"\n\t"+d.rhinoException.message+"\tcolumn: "+d.rhinoException.columnNumber()+"\tline: "+d.rhinoException.lineNumber():"UNKNOWN RUNTIME ERROR";print(this.formatter.format(h,f,g));break}}})})(jQuery,Claypool,Claypool.Logging);(function(b,a,d){d.ConsoleAppender=function(f){var h;try{if(window&&window.console&&window.console.log){try{if("Envjs" in window){return new d.SysOutAppender(f)}}catch(g){}b.extend(true,this,f);this.formatter=new d.FireBugFormatter(f);return this}else{return new d.SysOutAppender(f)}}catch(g){throw g}return this};function c(g,f){if(g.apply){g.apply(console,f)}else{if(f&&f.length){switch(f.length){case 1:g(f[0]);break;case 2:g(f[0],f[1]);break;case 3:g(f[0],f[1],f[2]);break;case 4:g(f[0],f[1],f[2],f[3]);break;case 5:g(f[0],f[1],f[2],f[3],f[4]);break;case 6:g(f[0],f[1],f[2],f[3],f[4],f[5]);break;case 7:g(f[0],f[1],f[2],f[3],f[4],f[5],f[6]);break;case 8:g(f[0],f[1],f[2],f[3],f[4],f[5],f[6],f[7]);break;case 9:g(f[0],f[1],f[2],f[3],f[4],f[5],f[6],f[7],f[8]);break}}}}b.extend(d.ConsoleAppender.prototype,d.Appender$Interface,{append:function(h,g,f){switch(h){case ("DEBUG"):c(console.log,this.formatter.format(h,g,f));break;case ("INFO"):c(console.info,this.formatter.format(h,g,f));break;case ("WARN"):c(console.warn,this.formatter.format(h,g,f));break;case ("ERROR"):c(console.error,this.formatter.format(h,g,f));break;case ("EXCEPTION"):c(console.error,[e]);break}}})})(jQuery,Claypool,Claypool.Logging);(function(b,a,c){c.Formatter$Interface={format:function(g,d,f){throw"MethodNotImplementedError"}}})(jQuery,Claypool,Claypool.Logging);(function(b,a,c){c.FireBugFormatter=function(d){b.extend(true,this,d)};b.extend(c.FireBugFormatter.prototype,c.Formatter$Interface,{getDateString:function(){return" ["+new Date().toUTCString()+"] "},format:function(j,g,h){var d=g+" "+j+": "+this.getDateString();h=(h&&h.length&&(h.length>0))?h:[];var f=(h.length>0)?h[0]:null;if(typeof(f)!="string"){h.unshift(d)}else{h[0]=d+f}return h}})})(jQuery,Claypool,Claypool.Logging);(function(d,b,g){var f=/((^%|[^\\]%)(\d+)?(\.)([a-zA-Z]))|((^%|[^\\]%)([a-zA-Z]))/,a=/function ?(.*?)\(/,c=/\[object (.*?)\]/;g.DefaultFormatter=function(h){d.extend(true,this,h)};d.extend(g.DefaultFormatter.prototype,g.Formatter$Interface,{getDateString:function(){return" ["+new Date().toUTCString()+"] "},format:function(h,j,q){var k=" "+h+":  "+this.getDateString()+"{"+j+"} ";var l=[k?k:""];var p=q[0];var m=0;if(typeof(p)!="string"){p="";m=-1}var n=this.parseFormat(p);var o;for(o=0;o<n.length;++o){if(n[o]&&typeof(n[o])=="object"){n[o].appender.call(this,q[++m],l)}else{this.appendText(n[o],l)}}for(o=m+1;o<q.length;++o){this.appendText(" ",l);if(typeof(q[o])=="string"){this.appendText(q[o],l)}else{this.appendObject(q[o],l)}}return l.join("")},parseFormat:function(p){var o=[];var j={s:this.appendText,d:this.appendInteger,i:this.appendInteger,f:this.appendFloat};var n;var l;var k;var h;for(h=f.exec(p);h;h=f.exec(p)){n=h[8]?h[8]:h[5];l=n in j?j[n]:this.appendObject;k=h[3]?parseInt(h[3],10):(h[4]=="."?-1:0);o.push(p.substr(0,h[0][0]=="%"?h.index:h.index+1));o.push({appender:l,precision:k});p=p.substr(h.index+h[0].length)}o.push(p);return o},objectToString:function(h){try{return h+""}catch(j){return null}},appendText:function(h,j){j.push(this.objectToString(h))},appendNull:function(h,j){j.push(this.objectToString(h))},appendString:function(h,j){j.push(this.objectToString(h))},appendInteger:function(h,j){j.push(this.objectToString(h))},appendFloat:function(h,j){j.push(this.objectToString(h))},appendFunction:function(k,l){var h=a.exec(this.objectToString(k));var j=h?h[1]:"function";l.push(this.objectToString(j))},appendObject:function(h,k){try{if(h===undefined){this.appendNull("undefined",k)}else{if(h===null){this.appendNull("null",k)}else{if(typeof h=="string"){this.appendString(h,k)}else{if(typeof h=="number"){this.appendInteger(h,k)}else{if(typeof h=="function"){this.appendFunction(h,k)}else{if(h.nodeType==1){this.appendSelector(h,k)}else{if(typeof h=="object"){this.appendObjectFormatted(h,k)}else{this.appendText(h,k)}}}}}}}}catch(j){}},appendObjectFormatted:function(j,l){var k=this.objectToString(j);var h=c.exec(k);l.push(h?h[1]:k)},appendSelector:function(h,j){j.push(h.nodeName.toLowerCase());if(h.id){j.push(h.id)}if(h.className){j.push(h.className)}j.push("</span>")},appendNode:function(k,l){var h;var j;var m;if(k.nodeType==1){l.push("<",k.nodeName.toLowerCase(),">");for(j=0;j<k.attributes.length;++j){h=k.attributes[j];if(!h.specified){continue}l.push(h.nodeName.toLowerCase(),'="',h.nodeValue,'"')}if(k.firstChild){for(m=k.firstChild;m;m=m.nextSibling){this.appendNode(m,html)}l.push("</",k.nodeName.toLowerCase(),">")}else{l.push("/>")}}else{if(k.nodeType==3){l.push(k.nodeValue)}}}})})(jQuery,Claypool,Claypool.Logging);(function(b,a,c){c.Factory=function(d){a.extend(this,a.BaseFactory);this.configurationId="logging";b.extend(true,this,d);this.logger=new c.Logger({category:"Claypool.Logging.Factory",level:"INFO",appender:"Claypool.Logging.ConsoleAppender"});this.attemptedConfigure=false};b.extend(c.Factory.prototype,a.BaseFactory.prototype,{create:function(h){var d,j,f,g;if(!this.configuration){if(!this.attemptedConfigure){this.logger.warn("Claypool Logging was not initalized correctly. Logging will not occur unless initialized.")
}this.attemptedConfigure=true;return new c.NullLogger()}else{d=h.split(".");for(i=0;i<d.length;i++){j=d.slice(0,d.length-i).join(".");f=this.find(j);if(f!==null){f.category=h;return new c.Logger(f)}}g=this.find("root");this.logger.debug("root logging category is set to %s",g);if(g!==null){g.category=h;return new c.Logger(g)}}this.logger.warn("No Matching category: %s Please configure a root logger.",h);return new c.NullLogger()},updateConfig:function(){var g;var f;var d;this.logger.debug("Configuring Claypool Logging");this.clear();g=this.getConfig()||[];for(d=0;d<g.length;d++){f=g[d];this.add(f.category,f)}return true}})})(jQuery,Claypool,Claypool.Logging);(function(c,a,d){c.extend(c,{logger:function(f){return d.getLogger(f)},logging:function(){if(arguments.length===0){return c.config("logging")}else{d.updated=true;return c.config("logging",arguments[0])}}});var b;c.extend(c,{debug:function(){b=b||c.logger("jQuery");b.debug.apply(b,arguments);return this},info:function(){b=b||c.logger("jQuery");b.info.apply(b,arguments);return this},warn:function(){b=b||c.logger("jQuery");b.warn.apply(b,arguments);return this},error:function(){b=b||c.logger("jQuery");b.error.apply(b,arguments);return this},exception:function(){b=b||c.logger("jQuery");b.exception.apply(b,arguments);return this}})})(jQuery,Claypool,Claypool.Logging);Claypool.Application={};(function(d,b,c){var a=0;c.context=null;d.extend(c,{getContext:function(){if(!c.context){c.context=new c.Context()}return c.context},Initialize:function(f){d(document).trigger("claypool:initialize",[c]);if(f){f()}d(document).trigger("ApplicationLoaded");return c.getContext()},Reinitialize:function(f){d(document).trigger("claypool:reinitialize",[c]);if(f){f()}d(document).trigger("ApplicationReloaded");return c.getContext()}});d.register(c,a);b.Commands={}})(jQuery,Claypool,Claypool.Application);(function(c,a,b){b.Context=function(d){a.extend(this,a.Context);this.contextContributors={};c.extend(true,this,d);this.logger=c.logger("Claypool.Application.Context")};c.extend(b.Context.prototype,a.Context.prototype,{get:function(h){var g,f,d;d=typeof(h)=="string"&&h.indexOf("#")>-1?[h.split("#")[0],"#"+h.split("#")[1]]:["",h];if(!this.find(d[0])){this.add(d[0],new a.SimpleCachingStrategy())}this.logger.debug("Searching application context for object: %s",h);g=null;g=this.find(d[0]).find(d[1]);if(g!==null){this.logger.debug("Found object in global application context. Object id: %s",h);return g}else{this.logger.debug("Searching for object in contributed application context. Object id: %s",h);for(f in this.contextContributors){this.logger.debug("Checking Application Context Contributor %s.",f);g=this.contextContributors[f].get(h);if(g!==null){this.logger.debug("Found object in contributed application context. Object id: %s",h);return g}}}this.logger.debug("Cannot find object in any application context. Object id: %s",h);return null},put:function(h,f){var g,d;g=typeof(h)=="string"&&h.indexOf("#")>-1?[h.split("#")[0],"#"+h.split("#")[1]]:["",h];d=this.find(g[0]);if(!d){d=new a.SimpleCachingStrategy();this.add(g[0],d)}if(d.find(g[0])){d.remove(g[1])}this.logger.debug("Adding object to global application context %s",h);d.add(g[1],f)}})})(jQuery,Claypool,Claypool.Application);(function(c,a,b){b.ContextContributor=function(d){a.extend(this,a.ContextContributor);c.extend(true,this,d);this.logger=c.logger("Claypool.Application.ContextContributor");return this};c.extend(b.ContextContributor.prototype,a.ContextContributor.prototype,{registerContext:function(d){this.logger.info("Registering Context id: %s",d);b.getContext().contextContributors[d]=this}})})(jQuery,Claypool,Claypool.Application);(function(c,a,b){b.Aware=function(d){c.extend(this,d);this.logger=c.logger("Claypool.Application.Aware")};c.extend(b.Aware.prototype,{$:function(){return b.getContext()}})})(jQuery,Claypool,Claypool.Application);(function(c,a,b){c.extend(c,{app:function(){return b.getContext()},boot:function(d){b.Initialize(d);return this},reboot:function(d){b.Reinitialize(d);return this},manage:function(d,f,g){c(document).bind("claypool:initialize",function(j,h){if(!h[f]){h[f]=new (c.resolve(d))();if(h.ContextContributor&&c.isFunction(h.ContextContributor)){h[f].registerContext(d)}}else{h[f].factory.updateConfig()}if(g&&c.isFunction(g)){g(h[f])}}).bind("claypool:reinitialize",function(j,h){h[f]=new (c.resolve(d))();if(h.ContextContributor&&c.isFunction(h.ContextContributor)){h[f].registerContext(d)}if(g&&c.isFunction(g)){g(h[f])}});return this}})})(jQuery,Claypool,Claypool.Application);Claypool.AOP={};(function(c,b,a){c.manage("Claypool.AOP.Container","claypool:AOP")})(jQuery,Claypool,Claypool.AOP);(function(c,b,a){a.Aspect=function(d){this.id=null;this.type=null;b.extend(this,b.SimpleCachingStrategy);c.extend(true,this,d);this.logger=c.logger("Claypool.AOP.Aspect");this.strategy=this.strategy||"all"};c.extend(a.Aspect.prototype,b.SimpleCachingStrategy.prototype,{weave:function(){var k=this;var h;var d;if(!this.target){k.logger.warn("No pointcut was specified.  Cant weave aspect.");return}var j=function(f){var n,m,l;k.logger.debug("Weaving Advice %s for Aspect %s",f,k.id);k.hasPrototype=typeof(k.target.prototype)!="undefined";m=k.hasPrototype?k.target.prototype[f]:k.target[f];n=k.advise(m,k._target,f);if(!k.hasPrototype){k.target[f]=n}else{k.target.prototype[f]=n}l={pointcut:n,cutline:m,method:f,target:k._target};return l};if(this.size===0){h=new RegExp(this[this.type?this.type:"method"]);d=this.target.prototype?this.target.prototype:this.target;for(var g in d){if(c.isFunction(d[g])&&h.test(g)){this.logger.debug("Adding aspect to method %s",g);this.add(b.uuid(),j(g));if(this.strategy==="first"){break}}}}return this},unweave:function(){var d;for(var f in this.cache){d=this.find(f);if(!this.hasPrototype){this.target[this.method]=d.cutline}else{this.target.prototype[this.method]=d.cutline}this.hasPrototype=null}this.clear();return true},advise:function(d){throw"MethodNotImplementedError"}})})(jQuery,Claypool,Claypool.AOP);(function(c,b,a){a.After=function(d){b.extend(this,a.Aspect);c.extend(true,this,d);this.logger=c.logger("Claypool.AOP.After");this.type="after"};c.extend(a.After.prototype,a.Aspect.prototype,{advise:function(d,f,h){var g=this;return function(){var j=d.apply(this,arguments);return g.advice.apply(g,[j,f,h])}}})})(jQuery,Claypool,Claypool.AOP);(function(c,b,a){a.Before=function(d){b.extend(this,a.Aspect);c.extend(true,this,d);this.logger=c.logger("Claypool.AOP.Before");this.type="before"};c.extend(a.Before.prototype,a.Aspect.prototype,{advise:function(d,f,h){var g=this;return function(){var j=[];g.logger.debug("cutline arguments length %s",arguments.length);for(var k=0;k<arguments.length;k++){j.push(arguments[k])}j.push({target:f,method:h});g.logger.debug("applying advice to %s.%s",f,h);g.advice.apply(g,j);return d.apply(this,arguments)}}})})(jQuery,Claypool,Claypool.AOP);(function(c,b,a){a.Around=function(d){b.extend(this,a.Aspect);c.extend(true,this,d);this.logger=c.logger("Claypool.AOP.Around");this.type="around"};c.extend(a.Around.prototype,a.Aspect.prototype,{advise:function(d,f,h){var g=this;return function(){var j={object:this,args:arguments};return g.advice.apply(g,[{object:j.object,arguments:j.args,target:f,method:h,proceed:function(){var k=d.apply(j.object,j.args);return k}}])}}})})(jQuery,Claypool,Claypool.AOP);(function(c,b,a){a.Factory=function(d){b.extend(this,b.BaseFactory);c.extend(true,this,d);this.configurationId="aop";this.aspectCache=null;this.logger=c.logger("Claypool.AOP.Factory");this.aspectCache=new b.SimpleCachingStrategy()};c.extend(a.Factory.prototype,b.BaseFactory.prototype,{updateConfig:function(f){var m=this;var g;var l;var k;var j,h,d,n;this.logger.debug("Configuring Claypool AOP AspectFactory");g=this.getConfig()||[];this.logger.debug("AOP Configurations: %d",g.length);for(k=0;k<g.length;k++){l=g[k];if(typeof(l.target)=="string"){if(!c.isFunction(l.advice)){l.advice=c.resolve(l.advice)}if(l.target.match("^ref://")){j=l.target.substr(6,l.target.length);
c(document).bind("claypool:ioc:"+j,function(s,t,r){m.logger.debug("Creating aspect id %s for instance %s",l.id);var o,q;q=typeof(t)=="string"&&t.indexOf("#")>-1?[t.split("#")[0],"#"+t.split("#")[1]]:["",t];if(!r.find(q[0])){r.add(q[0],new b.SimpleCachingStrategy())}o=r.find(q[0]).find(q[1]);l.literal={scope:"global",object:t};l._target=l.target;l.target=o._this;m.add(l.id,l);var p=m.create(l.id);o._this=p.target;r.find(q[0]).remove(q[1]);r.find(q[0]).add(q[1],o);m.logger.debug("Created aspect \n%s, \n%s")}).bind("claypool:predestroy:"+j,function(q,o){m.logger.debug("Destroying aspect id %s for instance %s",l.id);var p=m.aspectCache.find(l.id);if(p&&p.unweave){p.unweave()}})}else{if(l.target.match(/\.\*$/)){this.logger.debug("Broad aspect target %s",l.target);if(!f||(f.clazz.match(l.target))){h=c.resolve(l.target.substring(0,l.target.length-2));for(d in h){if(c.isFunction(h[d])){n=c.extend({},l,{id:l.id+b.uuid(),target:h[d],_target:l.target.substring(0,l.target.length-1)+d});this.logger.debug("Creating aspect id %s [%s] (%s)",l.target,d,n.id);this.add(n.id,n);this.create(n.id)}}}}else{if(!f||(f.clazz.match(l.target))){this.logger.debug("Creating aspect id %s",l.id);l._target=l.target;l.target=c.resolve(l.target);this.add(l.id,l);this.create(l.id)}}}}}return true},create:function(l,h){var k;var d;var f=this.aspectCache.find(l);var j=this;var g=function(n){var m=null;if(n.after){m=new a.After(n)}else{if(n.before){m=new a.Before(n)}else{if(n.around){m=new a.Around(n)}}}return m.weave()};if(f){return f}else{this.logger.debug("Looking for configuration for aspect %s",l);k=this.find(l);if(k===undefined||k===null){this.logger.debug("%s is not an Aspect.",l);return null}else{this.logger.debug("Found configuration for instance %s",l);if(k.selector){this.logger.debug("Attaching contructor to an active selector");j=this;d=function(){f=g(k);j.aspectCache.add(k.id+"#"+this.toString(),f);return f};if(k.active){c(k.selector).livequery(d)}else{c(k.selector).each(d)}}else{f=g(k);this.aspectCache.add(l,f)}return f}}}})})(jQuery,Claypool,Claypool.AOP);(function(c,b,a){a.Container=function(d){b.extend(this,b.Application.ContextContributor);c.extend(true,this,d);this.factory=null;this.logger=c.logger("Claypool.AOP.Container");this.logger.debug("Configuring Claypool AOP Container");this.factory=new a.Factory(d);this.factory.updateConfig()};c.extend(a.Container.prototype,b.Application.ContextContributor.prototype,{get:function(g){var d,f;f=typeof(g)=="string"&&g.indexOf("#")>-1?[g.split("#")[0],"#"+g.split("#")[1]]:["",g];if(!this.find(f[0])){this.add(f[0],new b.SimpleCachingStrategy())}this.logger.debug("Search for a container managed aspect :%s",g);d=this.find(f[0]).find(f[1]);if(d===undefined||d===null){this.logger.debug("Can't find a container managed aspect :%s",g);d=this.factory.create(f[1],f[0]);if(d!==null){this.find(f[0]).add(f[1],d);return d}}else{this.logger.debug("Found container managed instance :%s",g);return d}return null}})})(jQuery,Claypool,Claypool.AOP);(function(c,a,b){c.extend(c,{filters:function(){if(arguments.length===0){return c.config("aop")}else{return c.config("aop",arguments[0])}}})})(jQuery,Claypool,Claypool.AOP);Claypool.IoC={};(function(c,a,b){c.manage("Claypool.IoC.Container","claypool:IoC")})(jQuery,Claypool,Claypool.IoC);(function(c,a,b){b.Instance=function(f,d){c.extend(this,{_this:null,id:null,configuration:null,guid:a.uuid(),type:null,id:f,configuration:d||{},logger:c.logger("Claypool.IoC.Instance")});this.logger.category=this.logger.category+"."+this.id};c.extend(b.Instance.prototype,{precreate:function(){this._this={claypoolId:this.id};this.logger.debug("Precreating Instance");c(document).trigger("claypool:precreate",[this._this,this.id]);c(document).trigger("claypool:precreate:"+this.id,[this._this]);return this},create:function(){var j,p,f,g;var m,o,l,n;var d,k;this.logger.debug("Applying Selector to Instance");if(this.configuration.selector){this._this=c(this.configuration.selector);this.logger.debug("Result for selector : ",this._this)}else{this.logger.debug("Using default empty object");this._this={}}if(this.configuration.factory){j={};if(this.configuration.factory.substring(6,0)=="ref://"){this.logger.debug("Retreiving Factory from Application Context");j=c.$(this.configuration.factory)}else{this.logger.info("Creating Instance from Factory");p=this.resolveConstructor(this.configuration.factory);retval=p.apply(j,this.configuration.options);j=retval||j}this.logger.debug("Applying factory creation method");f=this.configuration.factoryMethod||"create";m=j[f].apply(j,this.configuration.options);this._this=c.extend(true,m,this._this)}else{this.logger.info("Creating Instance simulating constructor: %s",this.configuration.clazz);l=this.resolveConstructor(this.configuration.clazz);n=this.configuration.options||[];m={};switch(n.length){case 0:m=new l();break;case 1:m=new l(n[0]);break;case 2:m=new l(n[0],n[1]);break;case 3:m=new l(n[0],n[1],n[2]);break;case 4:m=new l(n[0],n[1],n[2],n[3]);break;case 5:m=new l(n[0],n[1],n[2],n[3],n[4]);break;case 6:m=new l(n[0],n[1],n[2],n[3],n[4],n[5]);break;case 7:m=new l(n[0],n[1],n[2],n[3],n[4],n[5],n[6]);break;case 8:m=new l(n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7]);break;case 9:m=new l(n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7],n[8]);break;default:o=l.apply(m,n);m=o||m}m.$ns=this.configuration.clazz;m.$log=c.logger(m.$ns);m.$log.debug("Created new instance of %s",m.$ns);this._this=c.extend(true,m,this._this)}d=this.configuration.inject||{};for(var h in d){k=d[h];if(c.isFunction(k.substring)&&(k.substring(0,6)=="ref://")){d[h]=c.$(k.substring(6,k.length))}}c.extend(this._this,d);c(document).trigger("claypool:create",[this._this,this.id]);c(document).trigger("claypool:create:"+this.id,[this._this]);return this._this},postcreate:function(){this.logger.debug("PostCreate invoked");c(document).trigger("claypool:postcreate",[this._this,this.id]);c(document).trigger("claypool:postcreate:"+this.id,[this._this]);return this._this},predestroy:function(){this.logger.debug("Predestory invoked");c(document).trigger("claypool:predestroy",[this._this,this.id]);c(document).trigger("claypool:predestroy:"+this.id,[this._this]);return this._this},destroy:function(){this.logger.info("Destroy invoked");c(document).trigger("claypool:destroy",[this._this,this.id]);c(document).trigger("claypool:destroy:"+this.id,[this._this]);return delete this._this},postdestroy:function(){this.logger.debug("Postdestory invoked");c(document).trigger("claypool:postdestroy",[this.id]);c(document).trigger("claypool:postdestroy:"+this.id);return this},resolveConstructor:function(d){var f=c.resolve(d);if(c.isFunction(f)){this.logger.debug(" Resolved "+d+" to a function");return f}else{throw ("NoSuchConstructor:"+d)}}})})(jQuery,Claypool,Claypool.IoC);(function($,$$,$$IoC){$$IoC.Factory=function(options){$$.extend(this,$$.BaseFactory);$.extend(true,this,options);this.configurationId="ioc";this.lazyLoadAttempts={};this.logger=$.logger("Claypool.IoC.Factory")};$.extend($$IoC.Factory.prototype,$$.BaseFactory.prototype,{createLifeCycle:function(instance){instance.precreate();instance.create();instance.postcreate()},destroyLifeCycle:function(instance){instance.predestroy();instance.destroy();instance.postdestroy()},create:function(id,namespace){var configuration,instance,_this=this,remote,folder,file,appbase,literal;namespace=namespace||"";if(!this.find(namespace)){this.logger.debug("Adding cache for namespace %s",namespace);this.add(namespace,new $$.SimpleCachingStrategy())}this.logger.debug("Looking for configuration for instance %s%s",namespace,id);configuration=this.find(namespace).find(id);if(configuration===null){this.logger.warn("No known configuration for instance %s%s",namespace,id);remote=id.match(/#([a-z]+([A-Z]?[a-z]+)+)([A-Z][a-z]+)+/);if(remote){_this.logger.debug("resolving lazyload %s",id);literal=[$$.Namespaces[namespace]];literal[1]=remote.pop();literal[1]=literal[1]+"s";appbase=$.env("appbase");if(appbase&&namespace){folder=""}else{if(namespace){folder=namespace+"/"
}else{folder=""}}appbase=(appbase===null)?"/":typeof(appbase)=="string"?appbase:appbase[namespace];folder=appbase+literal[1].toLowerCase()+"/";literal[2]=remote[1].substring(0,1).toUpperCase()+remote[1].substring(1);file=remote[1].toLowerCase()+".js";_this.logger.debug("attempting to lazyload %s from %s%s",id,folder,file);if(_this.lazyLoadAttempts[folder+file]){_this.logger.debug("already attempted to load %s%s",folder,file);return null}else{_this.lazyLoadAttempts[folder+file]=1;$.ajax({async:false,url:folder+file,dataType:"text",timeout:3000,success:function(text){_this.logger.info("lazyloaded %s ",literal.join("."));if(!$.env("debug")){jQuery.globalEval(text)}else{eval(text)}var config={id:id,namespace:namespace,clazz:literal.join(".")};if(literal[1]=="Views"){config.selector="#"+literal[2].substring(0,1).toLowerCase()+literal[2].substring(1)}_this.find(namespace).add(id,config);try{$$.Application["claypool:AOP"].factory.updateConfig(config)}catch(e){_this.logger.error("Failed in late binding to aop configuration").exception(e)}},error:function(xhr,status,e){_this.logger.error("failed (%s) to load %s%s",xhr.status,folder,file).exception(e)}});_this.logger.info("completed lazyloaded for %s%s ",id,namespace);return _this.create(id,namespace)}}else{_this.logger.warn("id requested did not match those applicable for late loading %s",id)}return null}else{this.logger.debug("Found configuration for instance %s%s",namespace,id);instance=new $$IoC.Instance(configuration.id,configuration);if(configuration.active&&configuration.selector){this.logger.debug("Attaching contructor to an active selector");instance.precreate();instance._this["@claypool:activeobject"]=configuration.selector;instance._this["@claypool:id"]=instance.id;jQuery(configuration.selector).livequery(function(){_this.logger.debug("Processing Creation Lifecycle.");_this.createLifeCycle(instance)},function(){_this.logger.debug("Processing Destruction Lifecycle.");_this.destroyLifeCycle(instance)})}else{this.logger.debug("Processing Creation Lifecycle.");this.createLifeCycle(instance)}return instance}},updateConfig:function(){var iocConfiguration;var iocconf;var i;this.logger.debug("Configuring Claypool IoC Factory");iocConfiguration=this.getConfig()||[];this.logger.debug("IoC Configurations: %d",iocConfiguration.length);for(i=0;i<iocConfiguration.length;i++){iocconf=iocConfiguration[i];if(iocconf.scan&&iocconf.factory){this.logger.debug("Scanning %s with %s",iocconf.scan,iocconf.factory);iocConfiguration=iocConfiguration.concat(iocconf.factory.scan(iocconf.scan,iocconf.namespace))}else{this.logger.debug("IoC Configuration for Id: %s%s",iocconf.namespace||"",iocconf.id);if(iocconf.namespace){if(!this.find(iocconf.namespace)){this.add(iocconf.namespace,new $$.SimpleCachingStrategy())}this.find(iocconf.namespace).add(iocconf.id,iocconf)}else{if(!this.find("")){this.add("",new $$.SimpleCachingStrategy())}this.find("").add(iocconf.id,iocconf)}}}return true}})})(jQuery,Claypool,Claypool.IoC);(function(c,a,b){b.Container=function(d){a.extend(this,a.Application.ContextContributor);c.extend(true,this,d);this.factory=null;this.logger=c.logger("Claypool.IoC.Container");this.logger.debug("Configuring Claypool IoC Container");this.factory=new b.Factory();this.factory.updateConfig()};c.extend(b.Container.prototype,a.Application.ContextContributor.prototype,{get:function(h){var d,f,g=this;f=typeof(h)=="string"&&h.indexOf("#")>-1?[h.split("#")[0],"#"+h.split("#")[1]]:["",h];if(!this.find(f[0])){this.add(f[0],new a.SimpleCachingStrategy())}this.logger.debug("Searching for a container managed instance :%s",h);d=this.find(f[0]).find(f[1]);if(!d){this.logger.debug("Can't find a container managed instance :%s",h);d=this.factory.create(f[1],f[0]);if(d){this.logger.debug("Storing managed instance %s in container",h);this.find(f[0]).add(f[1],d);if(d._this["@claypool:activeobject"]){c(document).bind("claypool:postcreate:"+d.id,function(k,j,l){g.logger.info("Reattached Active Object Inside IoC Container");d._this=j});c(document).bind("claypool:postdestroy:"+d.id,function(){g.logger.info("Removed Active Object Inside IoC Container");g.find(f[0]).remove(f[1])})}else{c(document).trigger("claypool:ioc",[h,this]);c(document).trigger("claypool:ioc:"+h,[h,this])}return this.find(f[0]).find(f[1])._this}}else{this.logger.debug("Found container managed instance :%s",h);return d._this}return null}})})(jQuery,Claypool,Claypool.IoC);(function(c,a,b){a.Namespaces={};c.extend(c,{scan:function(){var f,g;if(arguments.length===0){return c.config("ioc")}else{f=[];if(c.isPlainObject(arguments[0])){for(g in arguments[0]){d(arguments[0][g],g)}}else{if(c.isArray(arguments[0])){d(arguments[0])}else{if(typeof arguments[0]=="string"){d(arguments[0])}}}return c.config("ioc",f)}function d(k,j){var h;j=j||"";if(c.isArray(k)){if(!(j in a.Namespaces)){a.Namespaces[j]=k[0].split(".")[0]}for(h=0;h<k.length;h++){f.push({scan:k[h],factory:a.MVC.Factory.prototype,namespace:j?j:null})}}else{if(!(j in a.Namespaces)){a.Namespaces[j]=k}f.push({scan:k,factory:a.MVC.Factory.prototype,namespace:j?j:null})}}},invert:function(){if(arguments.length===0){return c.config("ioc")}else{return c.config("ioc",arguments[0])}}})})(jQuery,Claypool,Claypool.IoC);Claypool.MVC={};(function(a){a.manage("Claypool.MVC.Container","claypool:MVC",function(b){var f,h,c,d=b.factory.getConfig(),g;for(g in d){b.logger.debug("eagerly loading mvc routers: %s",g);for(f=0;f<d[g].length;f++){h=d[g][f].id;controller=b.get(h);b.logger.debug("attaching mvc core controller: %s",h);if(controller&&!controller.attached){controller.attach();controller.attached=true}}}})})(jQuery);(function(c,a,b){b.View$Interface={update:function(d){throw"MethodNotImplementedError"},think:function(){throw"MethodNotImplementedError"}}})(jQuery,Claypool,Claypool.MVC);(function(c,a,b){b.Controller=function(d){a.extend(this,a.SimpleCachingStrategy);c.extend(true,this,d);this.logger=c.logger("Claypool.MVC.Controller")};c.extend(b.Controller.prototype,a.SimpleCachingStrategy.prototype,{handle:function(d){throw"MethodNotImplementedError"}})})(jQuery,Claypool,Claypool.MVC);(function(c,a,b){b.HijaxController=function(d){a.extend(this,b.Controller);c.extend(true,this,{forwardingList:[],selector:"",filter:"",active:true,preventDefault:true,stopPropagation:true,hijaxMap:[],resolveQueue:[],strategy:null},d);this.router=new a.Router();this.bindCache=new a.SimpleCachingStrategy();this.logger=c.logger("Claypool.MVC.HijaxController")};c.extend(b.HijaxController.prototype,b.Controller.prototype,{handle:function(j){this.logger.debug("Handling pattern: %s",j.pattern);this.forwardingList=this.router[this.strategy||"all"](j.pattern);this.logger.debug("Resolving matched paterns");var k=this,f=j.args[0],d=[],h={};for(var g=1;g<j.args.length;g++){d[g-1]=j.args[g]}if(this.forwardingList.length>0){this.logger.debug("normalizing event state params %s",f);if(c.isFunction(this.normalize)){h=this.normalize(f)}}return jQuery(this.forwardingList).each(function(){var o,n,m,l;k.logger.info("Forwaring to registered controller %s",this.payload.controller);o=c.$(this.payload.controller);l=this.payload.controller;m=this.payload.controller.match("Controller")?this.payload.controller.replace("Controller","View"):null;m=this.payload.controller.match("Service")?this.payload.controller.replace("Service","View"):m;this.map=c.extend(h,this.map);(function(s){var p,q,u,r=c.extend({},f,{m:function(){if(arguments.length===0){return p}else{if(arguments.length===1){if(typeof(arguments[0])=="string"){return p[arguments[0]]}else{if(arguments[0] instanceof Array){p.length+=arguments[0].length;Array.prototype.push.apply(p,arguments[0])}else{if(arguments[0] instanceof Object){c.extend(true,p,arguments[0])}}}}else{if(arguments.length===2){if(arguments[1] instanceof Array){if(typeof(arguments[0])=="string"&&!(arguments[0] in p)){p[arguments[0]]=[]}c.merge(p[arguments[0]],arguments[1])}else{if(arguments[1] instanceof XML||arguments[1] instanceof XMLList){p[arguments[0]]=arguments[1]
}else{if(arguments[1] instanceof Object){if(typeof(arguments[0])=="string"&&!(arguments[0] in p)){p[arguments[0]]={}}c.extend(true,p[arguments[0]],arguments[1])}}}}}}return this},v:function(t){if(!t){return q}if(t&&typeof(t)=="string"){t=t.split(".");if(t.length===1){q=t}else{if(t.length===2){if(t[0]!==""){q=t.join(".")}else{q=q.split(".")[0]+"."+t[1]}}}}return this},c:function(){var w,v,t;if(arguments.length===0){return u}else{if(arguments.length>0&&typeof(arguments[0])=="string"){if(arguments.length>1&&c.isPlainObject(arguments[1])){s.map=c.extend(true,s.map||{},arguments[1])}w=arguments[0].split(".");q=w[0].match("Controller")?w[0].replace("Controller","View"):null;q=w[0].match("Service")?w[0].replace("Service","View"):q;v=(w.length>1&&w[1].length>0)?w[1]:"handle";t=k.find(w[0]);if(t===null){t=c.$(w[0]);k.add(w[0],t)}t[v||"handle"].apply(t,[this].concat(d))}}return this},render:k.renderer(),reset:function(){p={flash:[],length:0};q=m;u=l;p.reset=function w(){p={flash:[],length:0};p.reset=w;return r};q.reset=function t(){q=m;q.reset=t;return r};u.reset=function v(){u=l;u.reset=v;return r};return this},params:function(t){if(arguments.length===0){return s.map?s.map:{}}else{return(s.map&&(t in s.map))?s.map[t]:null}}});r.reset();o[s.payload.action||"handle"].apply(o,[r].concat(d))})(this)})},attach:function(){this.router.compile(this.hijaxMap,this.routerKeys);var d=this;if(this.active&&(this.selector!==""||this.filter!=="")){this.logger.debug("Actively Hijaxing %s's %s%s",this.hijaxKey,this.selector,this.filter);c(this.selector+this.filter).livequery(function(){d.hijax(this)})}else{if(this.selector!==""||this.filter!==""){this.logger.debug("Hijaxing Current %s's.",this.hijaxKey);c(this.selector+this.filter).each(function(){d.hijax(this)})}else{if(document!==undefined){this.logger.debug("Hijaxing Document For %s's.",this.hijaxKey);d.hijax(document)}else{this.logger.warn("Unable to attach controller: %s",options.id)}}}},hijax:function(f){this.logger.debug("Hijaxing %s: %s",this.hijaxKey,f);var g=this;var d=function(h){var j=true;g.logger.info("Hijaxing %s: ",g.hijaxKey);if(g.stopPropagation){g.logger.debug("Stopping propogation of event");h.stopPropagation()}if(g.preventDefault){g.logger.debug("Preventing default event behaviour");h.preventDefault();j=false}g.handle({pattern:g.target.apply(g,arguments),args:arguments,normalize:g.normalize?g.normalize:function(){return{}}});return j};if(this.event){c(this.event.split("|")).each(function(){c(f).bind(this+"."+g.eventNamespace,d);g.logger.debug("Binding event %s to hijax controller on target",this,f)})}else{c(this.hijaxMap).each(function(){if(this.event&&!g.bindCache.find(this.event)){g.bindCache.add(this.event,g);g.logger.debug("Binding event %s to controller %s on target %s",this.event,this.controller,f);c(f).bind(this.event+"."+g.eventNamespace,d)}})}return true},renderer:function(){var f=this;var d=[];return function(n){var m,h,l,g,j,k;if(n&&c.isFunction(n)){d.push(n)}f.logger.debug(" - Resolving Control - %s)",this.c());g=this.v();j=c.isFunction(this.write)?(c.isFunction(c.render)?"write":"render"):"update";if(g.indexOf(".")>-1){j=g.split(".");g=j[0];j=j[j.length-1]}f.logger.debug("Calling View %s.%s",g,j);g=c.$(g);if(g){if(c.isFunction(g[j])){switch(j){case"write":case"writeln":this[j](g[j](this.m(),this));break;case"render":g.write=this.write;g.writeln=this.writeln;g[j](this.m(),this);break;default:g[j](this.m(),this)}f.logger.debug("Cascading callbacks");while(d.length>0){(d.pop())()}}else{if(g["@claypool:activeobject"]){k="claypool:postcreate:"+g["@claypool:id"]+"."+a.uuid();c(document).bind(k,function(o,p){f.logger.warn("The view is reattached to the dom.");c(document).unbind(k);p.update(this.m());f.logger.debug("Cascading callbacks");while(d.length>0){(d.pop())()}})}else{f.logger.debug("View method cannot be resolve",j)}}}else{f.logger.warn("Cant resolve view %s. ",this.v())}return this}},target:function(d){throw"MethodNotImplementedError"}})})(jQuery,Claypool,Claypool.MVC);(function(c,a,b){b.Factory=function(d){a.extend(this,a.IoC.Factory);c.extend(true,this,d);this.configurationId="mvc";this.logger=c.logger("Claypool.MVC.Factory");this.add("",new a.SimpleCachingStrategy())};c.extend(b.Factory.prototype,a.IoC.Factory.prototype,{updateConfig:function(){var h,d,g,j,f;this.logger.debug("Configuring Claypool MVC Controller Factory");h=this.getConfig()||{};c(document).trigger("claypool:hijax",[this,this.initializeHijaxController,h])},scan:function(g,j){var k=this.logger||c.logger("Claypool.MVC.Factory");var f,n,d=[],l,m=function(o,p){return("#"+o.substring(0,1).toLowerCase()+o.substring(1)+p.substring(0,p.length-1))},h=function(o){return("#"+o.substring(0,1).toLowerCase()+o.substring(1))};j=j||"";k.debug("Scanning %s%s",j,g);if(g.split(".").length==1){n=c.resolve(g);for(f in n){k.debug("Scan Checking %s.%s",g,f);if(c.isPlainObject(n[f])){k.debug("Scan Following %s.%s",g,f);d.push(this.scan(g+"."+f,j))}}}else{if(g.split(".").length==2){n=c.resolve(g);for(f in n){k.debug("Scan Checking %s.%s",g,f);if(c.isFunction(n[f])){k.debug("Configuring by Convention %s.%s",g,f);config={id:m(f,g.split(".")[1]),clazz:g+"."+f,namespace:j};if(g.match(".Views")){config.selector=h(f)}d.push(config)}}}else{if(g.split(".").length==3){n=c.resolve(g);if(c.isFunction(n)){k.debug("Appending to Configuration by Convention %s",g);config={id:m(f,g.split(".")[2]),clazz:g,namespace:j};if(g.match(".Views")){config.selector=h(f)}d.push(config)}}}}return d},initializeHijaxController:function(j,h,f,d){var k,g;if(j[h]){for(g=0;g<j[h].length;g++){k={};k.id=j[h][g].id;k.clazz=f;k.options=[c.extend(true,{},d,j[h][g])];this.logger.debug("Adding MVC Configuration for Controller Id: %s",k.id);this.find("").add(k.id,k)}}}})})(jQuery,Claypool,Claypool.MVC);(function(c,a,b){b.Container=function(d){a.extend(this,a.Application.ContextContributor);c.extend(true,this,d);this.factory=null;this.logger=c.logger("Claypool.MVC.Container").debug("Configuring Claypool MVC Container");this.factory=new b.Factory();this.factory.updateConfig()};c.extend(b.Container.prototype,a.Application.ContextContributor.prototype,{get:function(g){var d,f;this.logger.debug("Search for a container managed controller : %s",g);f=typeof(g)=="string"&&g.indexOf("#")>-1?[g.split("#")[0],"#"+g.split("#")[1]]:["",g];if(!this.find(f[0])){this.add(f[0],new a.SimpleCachingStrategy())}d=this.find(f[0]).find(f[1]);if(d===undefined||d===null){this.logger.debug("Can't find a container managed controller : %s",g);d=this.factory.create(f[1],f[0]);if(d!==null){this.find(f[0]).add(f[1],d);return d._this}else{return null}}else{this.logger.debug("Found container managed controller : %s",g);return d._this}throw ("UnknownID:"+g)}})})(jQuery,Claypool,Claypool.MVC);(function(d,a,b){var c;d.extend(d,{router:function(g,f){d(document).bind("claypool:hijax",function(h,l,j,k){c=c||d.logger("Claypool.MVC.Plugins");c.debug("registering router plugin: %s",g);j.apply(l,[k,g,"Claypool.MVC.HijaxController",f])});return this},mvc:function(){var g,f;if(arguments.length===0){return d.config("mvc")}else{f=d.config("mvc");for(g in arguments[0]){if(g in f){d.merge(f[g],arguments[0][g])}else{f[g]=arguments[0][g]}}return this}}});d.routes=d.mvc;d.router("hijax:a",{selector:"a",event:"click",strategy:"first",routerKeys:"urls",hijaxKey:"link",eventNamespace:"Claypool:MVC:HijaxLinkController",target:function(g){var f=g.target||g.currentTarget;while(f.tagName.toUpperCase()!="A"){f=d(f).parent()[0]}return d(f).attr("href")},normalize:function(h){var g=h.target||h.currentTarget,j={};while(g.tagName.toUpperCase()!="A"){g=d(g).parent()[0]}var f=d(g).attr("href");var k=f.split("?");k=k&&k.length>1?k[1]:"";d(k.split("&")).each(function(n,q){var o=q.split("="),l=o[0],p=o[1],m;if(l in j){if(!d.isArray(j[l])){m=j[l];j[l]=[m]}j[l].push(p)}else{j[l]=p}});return j}}).router("hijax:button",{selector:":button",event:"click",strategy:"all",routerKeys:"ids",hijaxKey:"button",eventNamespace:"Claypool:MVC:HijaxButtonController",target:function(f){return f.target.id
},normalize:function(f){return{}}}).router("hijax:input",{selector:"input",event:"blur|focus",strategy:"all",routerKeys:"ids",hijaxKey:"input",eventNamespace:"Claypool:MVC:HijaxInputController",target:function(f){return f.target.id},normalize:function(f){var g={};g[f.target.name]=f.target.value;return g}}).router("hijax:form",{selector:"form",event:"submit",strategy:"first",routerKeys:"urls",hijaxKey:"form",eventNamespace:"Claypool:MVC:HijaxFormController",target:function(f){return f.target.action},normalize:function(f){var h={},g=d(f.target).serializeArray();d(g).each(function(l,j){var k;if(j.name in h){if(!d.isArray(h[j.name])){k=h[j.name];h[j.name]=[]}h[j.name].push(j.value)}else{h[j.name]=j.value}});return h}}).router("hijax:event",{strategy:"all",routerKeys:"event",hijaxKey:"event",eventNamespace:"Claypool:MVC:HijaxEventController",target:function(f){return f.type},normalize:function(f){return{}}});d.mvc_scanner=b.Factory.prototype})(jQuery,Claypool,Claypool.MVC);