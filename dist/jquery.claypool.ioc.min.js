Claypool.IoC={};(function(c,a,b){c.manage("Claypool.IoC.Container","claypool:IoC")})(jQuery,Claypool,Claypool.IoC);(function(c,a,b){b.Instance=function(e,d){c.extend(this,{_this:null,id:null,configuration:null,guid:a.uuid(),type:null,id:e,configuration:d||{},logger:c.logger("Claypool.IoC.Instance")});this.logger.category=this.logger.category+"."+this.id};c.extend(b.Instance.prototype,{precreate:function(){this._this={claypoolId:this.id};this.logger.debug("Precreating Instance");c(document).trigger("claypool:precreate",[this._this,this.id]);c(document).trigger("claypool:precreate:"+this.id,[this._this]);return this},create:function(){var h,n,e,f;var k,m,j,l;var d,i;this.logger.debug("Applying Selector to Instance");if(this.configuration.selector){this._this=c(this.configuration.selector);this.logger.debug("Result for selector : ",this._this)}else{this.logger.debug("Using default empty object");this._this={}}if(this.configuration.factory){h={};if(this.configuration.factory.substring(6,0)=="ref://"){this.logger.debug("Retreiving Factory from Application Context");h=c.$(this.configuration.factory)}else{this.logger.info("Creating Instance from Factory");n=this.resolveConstructor(this.configuration.factory);retval=n.apply(h,this.configuration.options);h=retval||h}this.logger.debug("Applying factory creation method");e=this.configuration.factoryMethod||"create";k=h[e].apply(h,this.configuration.options);this._this=c.extend(true,k,this._this)}else{this.logger.info("Creating Instance simulating constructor: %s",this.configuration.clazz);j=this.resolveConstructor(this.configuration.clazz);l=this.configuration.options||[];k={};switch(l.length){case 0:k=new j();break;case 1:k=new j(l[0]);break;case 2:k=new j(l[0],l[1]);break;case 3:k=new j(l[0],l[1],l[2]);break;case 4:k=new j(l[0],l[1],l[2],l[3]);break;case 5:k=new j(l[0],l[1],l[2],l[3],l[4]);break;case 6:k=new j(l[0],l[1],l[2],l[3],l[4],l[5]);break;case 7:k=new j(l[0],l[1],l[2],l[3],l[4],l[5],l[6]);break;case 8:k=new j(l[0],l[1],l[2],l[3],l[4],l[5],l[6],l[7]);break;case 9:k=new j(l[0],l[1],l[2],l[3],l[4],l[5],l[6],l[7],l[8]);break;default:m=j.apply(k,l);k=m||k}k.$ns=this.configuration.clazz;k.$log=c.logger(k.$ns);k.$log.debug("Created new instance of %s",k.$ns);this._this=c.extend(true,k,this._this)}d=this.configuration.inject||{};for(var g in d){i=d[g];if(c.isFunction(i.substring)&&(i.substring(0,6)=="ref://")){d[g]=c.$(i.substring(6,i.length))}}c.extend(this._this,d);c(document).trigger("claypool:create",[this._this,this.id]);c(document).trigger("claypool:create:"+this.id,[this._this]);return this._this},postcreate:function(){this.logger.debug("PostCreate invoked");c(document).trigger("claypool:postcreate",[this._this,this.id]);c(document).trigger("claypool:postcreate:"+this.id,[this._this]);return this._this},predestroy:function(){this.logger.debug("Predestory invoked");c(document).trigger("claypool:predestroy",[this._this,this.id]);c(document).trigger("claypool:predestroy:"+this.id,[this._this]);return this._this},destroy:function(){this.logger.info("Destroy invoked");c(document).trigger("claypool:destroy",[this._this,this.id]);c(document).trigger("claypool:destroy:"+this.id,[this._this]);return delete this._this},postdestroy:function(){this.logger.debug("Postdestory invoked");c(document).trigger("claypool:postdestroy",[this.id]);c(document).trigger("claypool:postdestroy:"+this.id);return this},resolveConstructor:function(d){var e=c.resolve(d);if(c.isFunction(e)){this.logger.debug(" Resolved "+d+" to a function");return e}else{throw ("NoSuchConstructor:"+d)}}})})(jQuery,Claypool,Claypool.IoC);(function($,$$,$$IoC){$$IoC.Factory=function(options){$$.extend(this,$$.BaseFactory);$.extend(true,this,options);this.configurationId="ioc";this.lazyLoadAttempts={};this.logger=$.logger("Claypool.IoC.Factory")};$.extend($$IoC.Factory.prototype,$$.BaseFactory.prototype,{createLifeCycle:function(instance){instance.precreate();instance.create();instance.postcreate()},destroyLifeCycle:function(instance){instance.predestroy();instance.destroy();instance.postdestroy()},create:function(id,namespace){var configuration,instance,_this=this,remote,folder,file,appbase,literal;namespace=namespace||"";if(!this.find(namespace)){this.logger.debug("Adding cache for namespace %s",namespace);this.add(namespace,new $$.SimpleCachingStrategy())}this.logger.debug("Looking for configuration for instance %s%s",namespace,id);configuration=this.find(namespace).find(id);if(configuration===null){this.logger.warn("No known configuration for instance %s%s",namespace,id);remote=id.match(/#([a-z]+([A-Z]?[a-z]+)+)([A-Z][a-z]+)+/);if(remote){_this.logger.debug("resolving lazyload %s",id);literal=[$$.Namespaces[namespace]];literal[1]=remote.pop();literal[1]=literal[1]+"s";appbase=$.env("appbase");if(appbase&&namespace){folder=""}else{if(namespace){folder=namespace+"/"}else{folder=""}}appbase=(appbase===null)?"/":typeof(appbase)=="string"?appbase:appbase[namespace];folder=appbase+literal[1].toLowerCase()+"/";literal[2]=remote[1].substring(0,1).toUpperCase()+remote[1].substring(1);file=remote[1].toLowerCase()+".js";_this.logger.debug("attempting to lazyload %s from %s%s",id,folder,file);if(_this.lazyLoadAttempts[folder+file]){_this.logger.debug("already attempted to load %s%s",folder,file);return null}else{_this.lazyLoadAttempts[folder+file]=1;$.ajax({async:false,url:folder+file,dataType:"text",timeout:3000,success:function(text){_this.logger.info("lazyloaded %s ",literal.join("."));if(!$.env("debug")){jQuery.globalEval(text)}else{eval(text)}var config={id:id,namespace:namespace,clazz:literal.join(".")};if(literal[1]=="Views"){config.selector="#"+literal[2].substring(0,1).toLowerCase()+literal[2].substring(1)}_this.find(namespace).add(id,config);try{$$.Application["claypool:AOP"].factory.updateConfig(config)}catch(e){_this.logger.error("Failed in late binding to aop configuration").exception(e)}},error:function(xhr,status,e){_this.logger.error("failed (%s) to load %s%s",xhr.status,folder,file).exception(e)}});_this.logger.info("completed lazyloaded for %s%s ",id,namespace);return _this.create(id,namespace)}}else{_this.logger.warn("id requested did not match those applicable for late loading %s",id)}return null}else{this.logger.debug("Found configuration for instance %s%s",namespace,id);instance=new $$IoC.Instance(configuration.id,configuration);if(configuration.active&&configuration.selector){this.logger.debug("Attaching contructor to an active selector");instance.precreate();instance._this["@claypool:activeobject"]=configuration.selector;instance._this["@claypool:id"]=instance.id;jQuery(configuration.selector).livequery(function(){_this.logger.debug("Processing Creation Lifecycle.");_this.createLifeCycle(instance)},function(){_this.logger.debug("Processing Destruction Lifecycle.");_this.destroyLifeCycle(instance)})}else{this.logger.debug("Processing Creation Lifecycle.");this.createLifeCycle(instance)}return instance}},updateConfig:function(){var iocConfiguration;var iocconf;var i;this.logger.debug("Configuring Claypool IoC Factory");iocConfiguration=this.getConfig()||[];this.logger.debug("IoC Configurations: %d",iocConfiguration.length);for(i=0;i<iocConfiguration.length;i++){iocconf=iocConfiguration[i];if(iocconf.scan&&iocconf.factory){this.logger.debug("Scanning %s with %s",iocconf.scan,iocconf.factory);iocConfiguration=iocConfiguration.concat(iocconf.factory.scan(iocconf.scan,iocconf.namespace))}else{this.logger.debug("IoC Configuration for Id: %s%s",iocconf.namespace||"",iocconf.id);if(iocconf.namespace){if(!this.find(iocconf.namespace)){this.add(iocconf.namespace,new $$.SimpleCachingStrategy())}this.find(iocconf.namespace).add(iocconf.id,iocconf)}else{if(!this.find("")){this.add("",new $$.SimpleCachingStrategy())}this.find("").add(iocconf.id,iocconf)}}}return true}})})(jQuery,Claypool,Claypool.IoC);(function(c,a,b){b.Container=function(d){a.extend(this,a.Application.ContextContributor);c.extend(true,this,d);this.factory=null;this.logger=c.logger("Claypool.IoC.Container");
this.logger.debug("Configuring Claypool IoC Container");this.factory=new b.Factory();this.factory.updateConfig()};c.extend(b.Container.prototype,a.Application.ContextContributor.prototype,{get:function(g){var d,e,f=this;e=typeof(g)=="string"&&g.indexOf("#")>-1?[g.split("#")[0],"#"+g.split("#")[1]]:["",g];if(!this.find(e[0])){this.add(e[0],new a.SimpleCachingStrategy())}this.logger.debug("Searching for a container managed instance :%s",g);d=this.find(e[0]).find(e[1]);if(!d){this.logger.debug("Can't find a container managed instance :%s",g);d=this.factory.create(e[1],e[0]);if(d){this.logger.debug("Storing managed instance %s in container",g);this.find(e[0]).add(e[1],d);if(d._this["@claypool:activeobject"]){c(document).bind("claypool:postcreate:"+d.id,function(i,h,j){f.logger.info("Reattached Active Object Inside IoC Container");d._this=h});c(document).bind("claypool:postdestroy:"+d.id,function(){f.logger.info("Removed Active Object Inside IoC Container");f.find(e[0]).remove(e[1])})}else{c(document).trigger("claypool:ioc",[g,this]);c(document).trigger("claypool:ioc:"+g,[g,this])}return this.find(e[0]).find(e[1])._this}}else{this.logger.debug("Found container managed instance :%s",g);return d._this}return null}})})(jQuery,Claypool,Claypool.IoC);(function(c,a,b){a.Namespaces={};c.extend(c,{scan:function(){var e,f;if(arguments.length===0){return c.config("ioc")}else{e=[];if(c.isPlainObject(arguments[0])){for(f in arguments[0]){d(arguments[0][f],f)}}else{if(c.isArray(arguments[0])){d(arguments[0])}else{if(typeof arguments[0]=="string"){d(arguments[0])}}}return c.config("ioc",e)}function d(j,h){var g;h=h||"";if(c.isArray(j)){if(!(h in a.Namespaces)){a.Namespaces[h]=j[0].split(".")[0]}for(g=0;g<j.length;g++){e.push({scan:j[g],factory:a.MVC.Factory.prototype,namespace:h?h:null})}}else{if(!(h in a.Namespaces)){a.Namespaces[h]=j}e.push({scan:j,factory:a.MVC.Factory.prototype,namespace:h?h:null})}}},invert:function(){if(arguments.length===0){return c.config("ioc")}else{return c.config("ioc",arguments[0])}}})})(jQuery,Claypool,Claypool.IoC);