Claypool.IoC={};(function(c,a,b){c.manage("Claypool.IoC.Container","claypool:IoC")})(jQuery,Claypool,Claypool.IoC);(function(c,a,b){b.Instance=function(e,d){c.extend(this,{_this:null,id:null,configuration:null,guid:c.guid(),type:null,id:e,configuration:d||{},logger:c.logger("Claypool.IoC.Instance")});this.logger.category=this.logger.category+"."+this.id};c.extend(b.Instance.prototype,{precreate:function(){try{this._this={claypoolId:this.id};this.logger.debug("Precreating Instance");c(document).trigger("claypool:precreate",[this._this,this.id]);c(document).trigger("claypool:precreate:"+this.id,[this._this]);return this}catch(d){this.logger.error("An Error occured in the Pre-Create LifeCycle Phase");this.logger.exception(d);throw new b.LifeCycleError(d)}},create:function(){var i,p,f,g;var l,o,k,n;var d,j;try{this.logger.debug("Applying Selector to Instance");if(this.configuration.selector){this._this=c(this.configuration.selector);this.logger.debug("Result for selector : ",this._this)}else{this.logger.debug("Using default empty object");this._this={}}if(this.configuration.factory){i={};if(this.configuration.factory.substring(6,0)=="ref://"){this.logger.debug("Retreiving Factory from Application Context");i=c.$(this.configuration.factory)}else{this.logger.info("Creating Instance from Factory");p=this.resolveConstructor(this.configuration.factory);retval=p.apply(i,this.configuration.options);i=retval||i}this.logger.debug("Applying factory creation method");f=this.configuration.factoryMethod||"create";l=i[f].apply(i,this.configuration.options);this._this=c.extend(true,l,this._this)}else{this.logger.info("Creating Instance simulating constructor: %s",this.configuration.clazz);k=this.resolveConstructor(this.configuration.clazz);n=this.configuration.options||[];l={};switch(n.length){case 0:l=new k();break;case 1:l=new k(n[0]);break;case 2:l=new k(n[0],n[1]);break;case 3:l=new k(n[0],n[1],n[2]);break;case 4:l=new k(n[0],n[1],n[2],n[3]);break;case 5:l=new k(n[0],n[1],n[2],n[3],n[4]);break;case 6:l=new k(n[0],n[1],n[2],n[3],n[4],n[5]);break;case 7:l=new k(n[0],n[1],n[2],n[3],n[4],n[5],n[6]);break;case 8:l=new k(n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7]);break;case 9:l=new k(n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7],n[8]);break;default:o=k.apply(l,n);l=o||l}l.$ns=this.configuration.clazz;l.$log=c.logger(l.$ns);l.$log.info("Created new instance of %s",l.$ns);this._this=c.extend(true,l,this._this)}d=this.configuration.inject||{};for(var h in d){j=d[h];if(c.isFunction(j.substring)&&(j.substring(0,6)=="ref://")){d[h]=c.$(j.substring(6,j.length))}}c.extend(this._this,d);c(document).trigger("claypool:create",[this._this,this.id]);c(document).trigger("claypool:create:"+this.id,[this._this]);return this._this}catch(m){this.logger.error("An Error occured in the Create LifeCycle Phase");this.logger.exception(m);throw new b.LifeCycleError(m)}},postcreate:function(){try{this.logger.debug("PostCreate invoked");c(document).trigger("claypool:postcreate",[this._this,this.id]);c(document).trigger("claypool:postcreate:"+this.id,[this._this]);return this._this}catch(d){this.logger.error("An Error occured in the Post-Create LifeCycle Phase");this.logger.exception(d);throw new b.LifeCycleError(d)}},predestroy:function(){try{this.logger.debug("Predestory invoked");c(document).trigger("claypool:predestroy",[this._this,this.id]);c(document).trigger("claypool:predestroy:"+this.id,[this._this]);return this._this}catch(d){this.logger.exception(d);throw new b.LifeCycleError(d)}},destroy:function(){try{this.logger.info("Destroy invoked");c(document).trigger("claypool:destroy",[this._this,this.id]);c(document).trigger("claypool:destroy:"+this.id,[this._this]);return delete this._this}catch(d){this.logger.exception(d);throw new b.LifeCycleError(d)}},postdestroy:function(){try{this.logger.debug("Postdestory invoked");c(document).trigger("claypool:postdestroy",[this.id]);c(document).trigger("claypool:postdestroy:"+this.id);return this}catch(d){this.logger.exception(d);throw new b.LifeCycleError(d)}},resolveConstructor:function(d){var f;try{f=c.resolve(d);if(c.isFunction(f)){this.logger.debug(" Resolved "+d+" to a function");return f}else{throw new Error("Constructor is not a function: "+d)}}catch(g){this.logger.exception(g);throw new b.ConstructorResolutionError(g)}}})})(jQuery,Claypool,Claypool.IoC);(function(c,a,b){b.Factory=function(d){a.extend(this,a.BaseFactory);c.extend(true,this,d);this.configurationId="ioc";this.logger=c.logger("Claypool.IoC.Factory")};c.extend(b.Factory.prototype,a.BaseFactory.prototype,{createLifeCycle:function(d){try{d.precreate();d.create();d.postcreate()}catch(f){this.logger.error("An Error occured in the Creation Lifecycle.");this.logger.exception(f);throw new b.LifeCycleError(f)}},destroyLifeCycle:function(d){try{d.predestroy();d.destroy();d.postdestroy()}catch(f){this.logger.error("An Error occured in the Destory Lifecycle.");this.logger.exception(f);throw new b.LifeCycleError(f)}},create:function(i){var h;var d;var g=this;try{this.logger.debug("Looking for configuration for instance %s",i);h=this.find(i);if(h===null){this.logger.warn("No known configuration for instance %s",i);return null}else{this.logger.debug("Found configuration for instance %s",i);d=new b.Instance(h.id,h);if(h.active&&h.selector){this.logger.debug("Attaching contructor to an active selector");d.precreate();d._this["@claypool:activeobject"]=h.selector;d._this["@claypool:id"]=d.id;jQuery(h.selector).livequery(function(){g.logger.debug("Processing Creation Lifecycle.");g.createLifeCycle(d)},function(){g.logger.debug("Processing Destruction Lifecycle.");g.destroyLifeCycle(d)})}else{this.logger.debug("Processing Creation Lifecycle.");this.createLifeCycle(d)}return d}}catch(f){this.logger.exception(f);throw new b.FactoryError(f)}},updateConfig:function(){var h;var d;var f;try{this.logger.debug("Configuring Claypool IoC Factory");h=this.getConfig()||[];this.logger.debug("IoC Configurations: %d",h.length);for(f=0;f<h.length;f++){try{d=h[f];if(d.scan&&d.factory){this.logger.debug("Scanning %s with %s",d.scan,d.factory);h=h.concat(d.factory.scan(d.scan))}else{this.logger.debug("IoC Configuration for Id: %s",d.id);this.add(d.id,d)}}catch(g){this.logger.exception(g);return false}}}catch(g){this.logger.exception(g);throw new b.ConfigurationError(g)}return true}})})(jQuery,Claypool,Claypool.IoC);(function(c,a,b){b.Container=function(d){a.extend(this,a.Application.ContextContributor);c.extend(true,this,d);this.factory=null;this.logger=c.logger("Claypool.IoC.Container");this.logger.debug("Configuring Claypool IoC Container");this.factory=new b.Factory();this.factory.updateConfig()};c.extend(b.Container.prototype,a.Application.ContextContributor.prototype,{get:function(h){var d;var g=this;try{this.logger.debug("Search for a container managed instance :%s",h);d=this.find(h);if(!d){this.logger.debug("Can't find a container managed instance :%s",h);d=this.factory.create(h);if(d){this.logger.debug("Storing managed instance %s in container",h);this.add(h,d);if(d._this["@claypool:activeobject"]){c(document).bind("claypool:postcreate:"+d.id,function(i,e,j){g.logger.info("Reattached Active Object Inside IoC Container");d._this=e});c(document).bind("claypool:postdestroy:"+d.id,function(){g.logger.info("Removed Active Object Inside IoC Container");g.remove(h)})}else{c(document).trigger("claypool:ioc",[h,this]);c(document).trigger("claypool:ioc:"+h,[h,this])}return this.find(h)._this}}else{this.logger.debug("Found container managed instance :%s",h);return d._this}}catch(f){this.logger.exception(f);throw new b.ContainerError(f)}return null}})})(jQuery,Claypool,Claypool.IoC);(function(c,a,b){b.ContainerError=function(d){c.extend(this,new a.Error(d,{name:"Claypool.IoC.ContainerError",message:"An error occured in the ioc instance factory."}))}})(jQuery,Claypool,Claypool.IoC);(function(c,a,b){b.FactoryError=function(d){c.extend(this,new a.Error(d,{name:"Claypool.IoC.FactoryError",message:"An error occured in the ioc factory."}))
}})(jQuery,Claypool,Claypool.IoC);(function(c,a,b){b.ConfigurationError=function(d){c.extend(this,new a.ConfigurationError(d,{name:"Claypool.IoC.ConfigurationError",message:"An error occured updating the ioc container configuration."}))}})(jQuery,Claypool,Claypool.IoC);(function(c,a,b){b.LifeCycleError=function(d){c.extend(this,new a.Error(d,{name:"Claypool.IoC.LifeCycleError",message:"An error occured during the lifecycle process."}))}})(jQuery,Claypool,Claypool.IoC);(function(c,a,b){b.ConstructorResolutionError=function(d){c.extend(this,new a.NameResolutionError(d,{name:"Claypool.IoC.ConstructorResolutionError",message:"An error occured trying to resolve the constructor."}))}})(jQuery,Claypool,Claypool.IoC);(function(c,a,b){c.extend(c,{scan:function(){var d,e;if(arguments.length===0){return c.config("ioc")}else{d=[];for(e=0;e<arguments[0].length;e++){d.push({scan:arguments[0][e],factory:a.MVC.Factory.prototype})}return c.config("ioc",d)}},invert:function(){if(arguments.length===0){return c.config("ioc")}else{return c.config("ioc",arguments[0])}}})})(jQuery,Claypool,Claypool.IoC);